---
import { getCollection } from 'astro:content'

import { SITE } from '~/config'
import Workbench from '~/layouts/Workbench.astro'
import Window from '~/components/Window.astro'
import Button from '~/components/Button.svelte'
import Image from '~/components/Image.astro'

export async function getStaticPaths() {
  const work = await getCollection('work')

  return work.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }))
}

const { entry } = Astro.props
const { data, slug } = entry
const { name, description, image, tags, url, sameAs } = data

const { Content } = await entry.render()

const title = `${name} - Work - ${SITE.name}`
// const url = `work/${slug}`
const keywords = tags.map(tag => tag)

const meta = { name, description, slug, sameAs, image }

const ldData = {
  '@context': 'https://schema.org',
  '@type': 'WebPage',
  name,
  description,
  url: `${SITE.url}/work/${slug}`,
  image: {
    '@type': 'ImageObject',
    url: `${SITE.url}${image.url}`,
    width: image.width,
    height: image.height,
    description: image.alt,
  },
  breadcrumb: {
    '@type': 'BreadcrumbList',
    itemListElement: [
      {
        '@type': 'ListItem',
        position: 1,
        item: {
          '@id': `${SITE.url}`,
          name: 'Workbench',
        },
      },
      {
        '@type': 'ListItem',
        position: 2,
        item: {
          '@id': `${SITE.url}/work`,
          name: 'Work',
        },
      },
      {
        '@type': 'ListItem',
        position: 3,
        item: {
          '@id': `${SITE.url}/work/${slug}`,
          name,
        },
      },
    ],
  },
  mainEntity: {
    '@type': 'CreativeWork',
    name,
    url: `${SITE.url}/work/${slug}`,
    sameAs,
    image: {
      '@type': 'ImageObject',
      url: `${SITE.url}${image.url}`,
      width: image.width,
      height: image.height,
      description: image.alt,
    },
    keywords,
    copyrightHolder: {
      '@type': 'Organization',
      name,
    },
  },
  copyrightHolder: {
    '@type': 'Person',
    name: 'Lance Guyatt',
  },
  copyrightYear: SITE.copyrightYear,
}
---

<Workbench {...meta}>
  <script
    slot="head"
    type="application/ld+json"
    set:html={JSON.stringify(ldData, null, 2)}
  ></script>
  <Window id={`window-${slug}`} name={name} url="/work" class="window">
    <div class="flex flex-col justify-center gap-6">
      {
        image && (
          <div class="h-36 w-36 self-center">
            <div class="aspect-square">
              <Image src={image.url} alt={image.alt} />
            </div>
          </div>
        )
      }
      <dl class="max-w-40rem mx-auto grid grid-cols-[1fr_11fr] gap-3">
        <dt
          class="flex items-center justify-end text-white after:content-[':']"
        >
          Name
        </dt>
        <dd class="p-2px border-img-foo">{name}</dd>
        {
          url && (
            <>
              <dt class="flex items-center justify-end text-white after:content-[':']">
                Url
              </dt>
              <dd class="p-2px border-img-foo">{url}</dd>
            </>
          )
        }
        <dt
          class="flex items-center justify-end text-white after:content-[':']"
        >
          Technologies
        </dt>
        <dd class="p-2px border-img-foo">
          <ul>
            {tags.map(tag => <li>{tag}</li>)}
          </ul>
        </dd>
      </dl>
      {
        Content && (
          <div class="mx-auto grid max-w-[40rem] grid-cols-[1fr_11fr] gap-3">
            <div />
            <div class="prose-black">
              <Content />
            </div>
          </div>
        )
      }
      <div class="flex justify-between">
        <Button href="/work">Cancel</Button>
        <Button href={url} target="_blank">Launch</Button>
      </div>
    </div>
  </Window>
</Workbench>

<!-- <style lang="postcss">
.window {
  @apply absolute top-[22px] right-0 bottom-0 left-0 z-20;

  @screen md {
    @apply top-1/2 left-1/2 w-1/2 right-auto bottom-auto -translate-x-1/2 -translate-y-1/2;
  }
}
</style> -->
