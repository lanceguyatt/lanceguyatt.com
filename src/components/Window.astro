---
import type { HTMLAttributes } from 'astro/types'
import { cva, type VariantProps } from 'class-variance-authority'

import Close from '~components/Close.astro'

const window = cva('window grid', {
  variants: {
    intent: {
      default: '',
      backdrop: 'absolute top-titlebar bottom-0 w-full z-0',
      modal:
        'absolute top-titlebar bottom-0 w-full z-10 md:w-1/2 md:h-1/2 md:left-1/2 md:-translate-x-1/2 md:top-1/2 md:-translate-y-1/2',
      modal2:
        'absolute top-titlebar bottom-0 w-full z-20 md:w-1/2 md:h-1/2 md:left-1/2 md:-translate-x-1/2 md:top-1/2 md:-translate-y-1/2'
    },
    size: {
      small: ['text-sm'],
      medium: ['text-base'],
      large: ['text-lg']
    },
    active: {
      true: 'bg-primary text-primary-foreground'
    }
  },
  defaultVariants: { intent: 'default', size: 'medium', active: false }
})

export interface Props
  extends HTMLAttributes<'section'>,
    VariantProps<typeof window> {
  id: string
  name: string
  url?: string
  className?: string
}

const { id, name, intent, size, active, url = '/', className } = Astro.props
---

<section
  class={window({ intent, size, active, className })}
  aria-labelledby={id}
>
  <div class="absolute -top-5 -mx-1 flex h-[18px] items-center">
    <div class="flex-none">
      <Close name={`Close the ${name} window`} url={url} />
    </div>
    <h2
      class="text-base/tightest flex-auto overflow-hidden text-ellipsis whitespace-nowrap"
      id={id}
    >
      {name}
    </h2>
  </div>
  <div class="flex-auto overflow-auto bg-secondary p-3">
    <slot />
  </div>
</section>

<style lang="postcss" is:global>
  .window {
    border-width: 22px 4px 4px 4px;
    border-image: url(/images/window.svg) 22 4 4 4 stretch;
  }
</style>
