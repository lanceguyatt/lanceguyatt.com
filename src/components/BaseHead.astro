---
import { SEO } from 'astro-seo'
import { SITE } from '~/config'
import type { IWorkbench } from '~layouts/Workbench.astro'

const GTM_ID = import.meta.env.PUBLIC_GTM_ID
// console.log(import.meta.env)

interface IBaseHead extends IWorkbench {
  noindex?: boolean
}

const {
  title = SITE.name,
  description = SITE.description,
  url = '/',
  image = SITE.image,
  noindex = false
} = Astro.props as IBaseHead
---

<head>
  <meta name="charset" content="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <SEO
    title={title}
    titleTemplate={`%s - ${SITE.name}`}
    titleDefault={`Default title`}
    description={description}
    canonical={`${SITE.url}${url}`}
    noindex={noindex}
    openGraph={{
      basic: {
        title,
        type: 'webpage',
        image: `${SITE.url}${image.url}`,
        url: `${SITE.url}${url}`
      },
      optional: {
        description,
        locale: SITE.locale,
        siteName: SITE.name
      },
      image: {
        width: image.width,
        height: image.height,
        alt: image.alt
      }
    }}
    twitter={{
      card: 'summary_large_image',
      site: SITE.twitter,
      creator: SITE.twitter
    }}
    extend={{
      link: [
        { rel: 'icon', type: 'image/svg+xml', href: '/favicon.svg' },
        { rel: 'author', type: 'text/plain', href: '/humans.txt' },
        {
          rel: 'mainfest',
          href: '/manifest.webmanifest',
          crossOrigin: 'anonymous'
        },
        {
          rel: 'apple-touch-icon',
          href: '/apple-touch-icon.png'
        }
      ],
      meta: [{ name: 'theme-color', content: SITE.themeColor }]
    }}
  />
  <slot />
  <script
    type="text/partytown"
    src=`https://www.googletagmanager.com/gtag/js?id=${GTM_ID}`
  ></script>
  <script>
    window.dataLayer = window.dataLayer || []
    function gtag() {
      window.dataLayer.push(arguments)
    }
    gtag('js', new Date())
    gtag('config', '`${GTM_ID}`')
  </script>
</head>
